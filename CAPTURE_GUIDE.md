# 📹 SwinUNet-VOG 数据采集工具使用指南

## 🚀 快速开始

### 方式 1：直接运行 Python（推荐）

```bash
python3 capture.py
```

### 方式 2：使用启动脚本

```bash
./run_capture.sh
```

---

## 🎯 界面说明

程序启动后，会看到如下界面：

```
┌──────────────────────────────────────────────────────────┐
│  采集参数                                                  │
├──────────────────────────────────────────────────────────┤
│ 📷 摄像头：[选择摄像头 ▼]  [🔄] [🔗 OBS]                  │
│ 📐 分辨率：[选择分辨率 ▼]  ⏱️ 帧率 (FPS)：[选择帧率 ▼]    │
│ 💾 输出文件：[文件路径........] [浏览...]                 │
│ 🎬 编码格式：[YUY2 ▼] [❓] YUY2/UYVY/I420=无压缩...       │
│ 👁️  功能：☑ 启用实时眼睛检测 (MediaPipe)                 │
└──────────────────────────────────────────────────────────┘
│                   实时预览                                 │
│                 (黑色区域/摄像头画面)                       │
│                                                            │
└──────────────────────────────────────────────────────────┘
│  操作                                                      │
├──────────────────────────────────────────────────────────┤
│  [👁️ 开始预览]  [⏹️ 停止预览]                            │
│  [🔴 开始录制]   [❌ 退出]                                │
└──────────────────────────────────────────────────────────┘
```

---

## 📋 各部分功能详解

### 1️⃣ 采集参数区

| 组件 | 说明 | 注意事项 |
|------|------|---------|
| **📷 摄像头** | 选择要使用的摄像头 | 插入 USB 摄像头后点击 🔄 刷新 |
| **🔄 刷新** | 重新扫描可用摄像头 | 如果摄像头未显示，点击这个 |
| **🔗 OBS** | 与 OBS 检测参数同步 | 如果自动检测不准，手动输入 |
| **📐 分辨率** | 选择拍摄分辨率 | 自动检测相机支持的值 |
| **⏱️ 帧率** | 选择拍摄帧率 | 越高越占用空间 |
| **💾 输出文件** | 视频保存位置 | 默认当前目录的 capture.avi |
| **浏览...** | 选择文件保存位置 | 支持任意目录 |
| **🎬 编码格式** | 视频编码方式 | YUY2（推荐）= 无损，最大质量 |
| **❓** | 查看编码格式详细说明 | 点击了解各格式的区别 |
| **👁️ 功能** | 启用眼睛检测 | ☑ = 启用，☐ = 禁用 |

### 2️⃣ 实时预览区

- **黑色区域**：摄像头画面会显示在这里
- **启用眼睛检测时**：会看到绿色的眼眶轮廓
- **显示的信息**：分辨率、帧率、检测状态

### 3️⃣ 操作按钮区

| 按钮 | 功能 | 何时使用 |
|------|------|---------|
| **👁️ 开始预览** | 启动摄像头预览 | 配置好参数后，先预览确认效果 |
| **⏹️ 停止预览** | 停止预览并释放摄像头 | 预览中点击停止 |
| **🔴 开始录制** | 开始录制视频 | 确认预览效果满意后录制 |
| **❌ 退出** | 关闭程序 | 随时点击退出 |

---

## 🎬 完整使用流程

### Step 1: 准备工作
```
1. 插入 USB 摄像头
2. 打开程序：python3 capture.py
```

### Step 2: 配置参数
```
1. 点击 🔄 刷新，检测摄像头
2. 在下拉菜单选择你的摄像头
3. 选择分辨率（推荐 1280×720）
4. 选择帧率（推荐 30 FPS）
5. 确认输出文件位置
6. 确认编码格式（推荐 YUY2）
7. 保持 ☑ 眼睛检测启用
```

### Step 3: 预览测试
```
1. 点击 👁️ 开始预览
2. 等待摄像头画面显示
3. 检查：
   - 图像质量是否清晰
   - 眼睛区域是否有绿色轮廓
   - 光线是否充足
4. 如果满意，点击 ⏹️ 停止预览
```

### Step 4: 正式录制
```
1. 调整被拍摄者位置
2. 点击 🔴 开始录制
3. 在弹出的预览窗口中：
   - 实时显示录制过程
   - 左上角显示检测状态
4. 按键盘：
   - 按 'q' 结束录制
   - 按 'Esc' 结束录制
5. 录制完成后会显示统计信息
```

---

## 🎥 录制过程中的显示信息

```
============================================================
🎬 开始录制
============================================================
摄像头索引：0
输出文件：/path/to/capture.avi
分辨率：1280×720
帧率：30.00 FPS
编码：YUY2
眼睛检测：启用

按 'q' 或 'Esc' 结束录制

👁️ 已检测     ← 实时显示检测状态
```

---

## 💾 录制完成后的信息

```
============================================================
✅ 录制完成
============================================================
总帧数：900
耗时：30.00 秒
文件大小：108.50 MB
============================================================
```

---

## 🛠️ 编码格式选择建议

### 用于眼睛追踪研究 (推荐)
- **首选**：YUY2 或 UYVY
  - 原因：无损采样，眼睛细节最清晰
  - 文件大：约 122 MB/分钟 @ 1280×720 30fps
  
- **备选**：I420
  - 原因：无损，文件小 50%，质量仍很好
  - 文件大：约 93 MB/分钟

### 用于预览/测试
- **MJPG**：快速，文件小，但有损失
- **XVID**：平衡压缩和质量

### 不建议
- ❌ MJPG（有损，不适合科研）
- ❌ XVID（有损，不适合眼睛细节分析）

---

## 🔗 与 OBS 同步

如果自动检测的分辨率/帧率与 OBS 检测到的不一致：

1. 在 OBS 中查看摄像头属性
2. 记下分辨率（如 1920×1080）和帧率（如 60）
3. 点击程序中的 **🔗 OBS** 按钮
4. 输入对应的分辨率和帧率
5. 点击 ✅ 应用

---

## ❓ 常见问题

### Q1: 摄像头不显示
**A:** 
- 确认 USB 摄像头已插入
- 点击 🔄 刷新按钮
- 检查摄像头驱动是否安装

### Q2: 预览很卡
**A:**
- 降低分辨率
- 启用眼睛检测时需要更多 CPU
- 关闭眼睛检测（取消勾选）试试

### Q3: 文件很大
**A:**
- YUY2 是无损，文件确实大
- 改用 I420 格式（减少 50% 大小）
- 降低分辨率或帧率

### Q4: 眼睛检测不工作
**A:**
- 确保安装了 mediapipe：`pip install mediapipe`
- 人脸和眼睛要在摄像头范围内
- 光线要充足

### Q5: 如何中止录制
**A:**
- 在预览窗口中按 'q'
- 或按 'Esc' 键
- **不要关闭窗口！** 会丢失数据

---

## 📊 参数推荐方案

### 方案 1: 最高质量（推荐用于研究）
```
分辨率：1280×720
帧率：30 FPS
编码：YUY2
眼睛检测：☑ 启用
文件大小：约 122 MB/分钟
```

### 方案 2: 平衡方案
```
分辨率：1280×720
帧率：30 FPS
编码：I420
眼睛检测：☑ 启用
文件大小：约 93 MB/分钟
```

### 方案 3: 高帧率方案
```
分辨率：1280×720
帧率：60 FPS
编码：I420
眼睛检测：☑ 启用
文件大小：约 186 MB/分钟
```

### 方案 4: 经济方案
```
分辨率：640×480
帧率：30 FPS
编码：I420
眼睛检测：☑ 启用
文件大小：约 20 MB/分钟
```

---

## 🎯 优化建议

### 光线很重要
- 💡 使用充足的正面光线
- 🚫 避免逆光（会导致眼睛过暗）
- 🔦 考虑加补光灯

### 位置很重要
- 📏 保持与摄像头的距离 30-50 cm
- 📍 面部要在屏幕中央
- 👀 眼睛要清晰可见

### 设置很重要
- 🖥️ 关闭其他占用 CPU 的程序
- 📡 若无线鼠标/键盘，考虑用有线
- 🔌 USB 摄像头用 USB 3.0 接口

---

## 📝 输出文件

默认输出到当前目录：`capture.avi`

### 文件格式
- **容器**：AVI
- **编码**：根据选择（YUY2/UYVY/I420/MJPG/XVID）
- **分辨率**：根据选择
- **帧率**：根据选择

### 兼容性
- ✅ 可在 FFmpeg、VLC 等播放器打开
- ✅ 可用 OpenCV 读取进行分析
- ✅ 可导入后期处理软件

---

## 💡 技巧

### 快速重复同一参数
1. 配置好参数
2. 每次点击 🔴 开始录制 就会用相同参数
3. 文件名会自动覆盖（或手动改名）

### 多个摄像头
1. 点击 🔄 刷新会列出所有摄像头
2. 从下拉菜单选择不同摄像头
3. 可分别配置不同参数

### 预览卡顿
- 关闭其他程序释放 CPU
- 取消勾选眼睛检测
- 降低分辨率

---

有问题？检查终端输出或查看程序日志！



