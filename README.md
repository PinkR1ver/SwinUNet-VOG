# SwinUNet-VOG: åŸºäº Swin Transformer çš„è§†çº¿ä¼°è®¡ç³»ç»Ÿ

ä¸€ä¸ªå®Œæ•´çš„æ·±åº¦å­¦ä¹ è§†çº¿è¿½è¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«æ¨¡å‹è®­ç»ƒã€è¯„ä¼°ã€å®æ—¶å¯è§†åŒ–å’Œ Web éƒ¨ç½²ã€‚

[![License](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)
[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-1.10%2B-orange.svg)](https://pytorch.org/)

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¨¡å‹è®­ç»ƒ](#æ¨¡å‹è®­ç»ƒ)
- [å¯è§†åŒ–å·¥å…·](#å¯è§†åŒ–å·¥å…·)
- [æ€§èƒ½ä¸ç³»ç»Ÿéœ€æ±‚](#æ€§èƒ½ä¸ç³»ç»Ÿéœ€æ±‚)
- [Web éƒ¨ç½²](#web-éƒ¨ç½²)
- [æŠ€æœ¯ç»†èŠ‚](#æŠ€æœ¯ç»†èŠ‚)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®ç®€ä»‹

SwinUNet-VOG å®ç°äº†ä¸€ä¸ªåŸºäº **Swin Transformer** å’Œ **U-Net** æ¶æ„çš„è§†çº¿ä¼°è®¡æ¨¡å‹ï¼Œåœ¨ MPIIGaze æ•°æ®é›†ä¸Šè¾¾åˆ°äº† **~5.7Â°** çš„å¹³å‡è§’åº¦è¯¯å·®ã€‚

### ç®—æ³•æµç¨‹

```
è¾“å…¥ (36Ã—60Ã—3) â†’ é¢„å¤„ç† â†’ SwinUNet â†’ 3Då‘é‡ (x,y,z) â†’ Pitch/Yawè§’åº¦
```

### æ ¸å¿ƒç»„ä»¶

- **æ¨¡å‹è®­ç»ƒ** (`train.py`)ï¼šå®Œæ•´çš„è®­ç»ƒæµç¨‹ï¼Œæ”¯æŒè·¨è¢«è¯•å’Œä¸ªäººåŒ–è¯„ä¼°
- **æ¨¡å‹è¯„ä¼°** (`test.py`)ï¼šè¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œå¯è§†åŒ–
- **GUI å¯è§†åŒ–** (`gui_visualizer.py`)ï¼šå®æ—¶è§†é¢‘å¤„ç†å’Œçœ¼åŠ¨è¿½è¸ª
- **Web éƒ¨ç½²** (`js/`)ï¼šæµè§ˆå™¨ç«¯æ¨ç†ï¼Œæ”¯æŒè§†é¢‘æ–‡ä»¶å¤„ç†

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ¨¡å‹è®­ç»ƒ
- **SwinUNet æ¶æ„**ï¼šU-Net + Swin Transformerï¼Œå‚æ•°é‡ ~7.6M
- **åŒè¯„ä¼°åè®®**ï¼šè·¨è¢«è¯•ï¼ˆcross-subjectï¼‰å’Œä¸ªäººåŒ–ï¼ˆperson-specificï¼‰
- **å®Œæ•´é¢„å¤„ç†**ï¼šå…‰ç…§/å¯¹æ¯”åº¦/å‡ ä½•å½’ä¸€åŒ–
- **è®­ç»ƒç›‘æ§**ï¼šå®æ—¶æ›²çº¿ã€æ£€æŸ¥ç‚¹ä¿å­˜ã€è‡ªåŠ¨å­¦ä¹ ç‡è°ƒæ•´

### ğŸ“Š å¯è§†åŒ–éƒ¨ç½²
- **GUI ç•Œé¢**ï¼šæ‹–æ‹½è§†é¢‘ï¼Œå®æ—¶æ˜¾ç¤ºçœ¼éƒ¨ ROI å’Œè§’åº¦æ›²çº¿
- **çœ¨çœ¼å¤„ç†**ï¼šåŸºäºæ—¶é—´çš„çœ¨çœ¼çª—å£æ‰©å±•ï¼ˆÂ±200msï¼‰ï¼Œæ’å€¼å¹³æ»‘
- **ä¿¡å·æ»¤æ³¢**ï¼šä¸­å€¼æ»¤æ³¢å»é™¤å°–å³° + ä½é€šæ»¤æ³¢å¹³æ»‘æ›²çº¿
- **äº¤äº’å¼å›æ”¾**ï¼šæ‹–åŠ¨æ—¶é—´è½´æŸ¥çœ‹å¯¹åº”è§†é¢‘å¸§å’Œçœ¼éƒ¨å›¾åƒ

### ğŸŒ Web éƒ¨ç½²
- **æµè§ˆå™¨ç«¯æ¨ç†**ï¼šONNX Runtime Web + MediaPipe
- **æœ¬åœ°éƒ¨ç½²**ï¼šæ— éœ€ç½‘ç»œï¼Œæ‰€æœ‰ä¾èµ–æœ¬åœ°åŒ–
- **å®æ—¶å¤„ç†**ï¼šæ”¯æŒè§†é¢‘æ–‡ä»¶ä¸Šä¼ å’Œé€å¸§å¤„ç†

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-repo/SwinUNet-VOG.git
cd SwinUNet-VOG

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

**ä¸»è¦ä¾èµ–**ï¼š
- `torch >= 1.10`
- `opencv-python`
- `mediapipe`
- `customtkinter`
- `matplotlib`
- `scipy`

### 2. å‡†å¤‡æ•°æ®é›†

ä¸‹è½½ [MPIIGaze æ•°æ®é›†](https://www.mpi-inf.mpg.de/departments/computer-vision-and-machine-learning/research/gaze-based-human-computer-interaction/appearance-based-gaze-estimation-in-the-wild/)ï¼Œè§£å‹åˆ° `MPIIGaze/` ç›®å½•ï¼š

```
MPIIGaze/
    â”œâ”€â”€ Data/
    â”‚   â””â”€â”€ Normalized/
    â”‚       â”œâ”€â”€ p00/
    â”‚       â”œâ”€â”€ p01/
    â”‚       â””â”€â”€ ...
â””â”€â”€ Evaluation Subset/
```

### 3. è®­ç»ƒæ¨¡å‹

```bash
# è·¨è¢«è¯•è¯„ä¼°ï¼ˆç•™ä¸€æ³•ï¼‰
python train.py --eval_mode cross_subject

# ä¸ªäººåŒ–è¯„ä¼°
python train.py --eval_mode person_specific --test_person p00
```

### 4. è¯„ä¼°æ¨¡å‹

```bash
python test.py --checkpoint checkpoints/checkpoint_best.pth
```

### 5. å¯è§†åŒ–å·¥å…·

```bash
python gui_visualizer.py
```

æ“ä½œæ­¥éª¤ï¼š
1. ç‚¹å‡» "Select Video File" é€‰æ‹©è§†é¢‘
2. ç‚¹å‡» "Start Processing" å¼€å§‹å¤„ç†
3. è§‚å¯Ÿå®æ—¶çœ¼éƒ¨ ROI å’Œè§’åº¦æ›²çº¿
4. å¤„ç†å®Œæˆåï¼Œæ‹–åŠ¨å›¾è¡¨æŸ¥çœ‹ä»»æ„æ—¶åˆ»çš„è§†é¢‘å¸§

---

## æ¨¡å‹è®­ç»ƒ

### è®­ç»ƒå‚æ•°

```bash
python train.py \
    --eval_mode cross_subject \
    --batch_size 128 \
    --epochs 50 \
    --lr 0.001 \
    --device cuda
```

### å…³é”®å‚æ•°è¯´æ˜

- `--eval_mode`: è¯„ä¼°æ¨¡å¼
  - `cross_subject`: è·¨è¢«è¯•ï¼ˆç•™ä¸€æ³•ï¼Œè®­ç»ƒ14äººï¼Œæµ‹è¯•1äººï¼‰
  - `person_specific`: ä¸ªäººåŒ–ï¼ˆå•äººæ•°æ®åˆ†å‰²ï¼‰
- `--test_person`: ä¸ªäººåŒ–æ¨¡å¼ä¸‹çš„æµ‹è¯•è¢«è¯•ï¼ˆå¦‚ `p00`ï¼‰
- `--batch_size`: æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤ 128ï¼‰
- `--epochs`: è®­ç»ƒè½®æ•°ï¼ˆé»˜è®¤ 50ï¼‰
- `--lr`: å­¦ä¹ ç‡ï¼ˆé»˜è®¤ 0.001ï¼‰

### è¾“å‡ºæ–‡ä»¶

è®­ç»ƒå®Œæˆåï¼Œ`checkpoints/` ç›®å½•åŒ…å«ï¼š
- `checkpoint_best.pth`: æœ€ä½³æ¨¡å‹ï¼ˆéªŒè¯é›†è¯¯å·®æœ€ä½ï¼‰
- `checkpoint_latest.pth`: æœ€æ–°æ¨¡å‹
- `training_curves.png`: è®­ç»ƒ/éªŒè¯æŸå¤±æ›²çº¿
- `angle_error_curves.png`: è§’åº¦è¯¯å·®æ›²çº¿
- `training_summary.json`: è®­ç»ƒæ‘˜è¦

---

## å¯è§†åŒ–å·¥å…·

### GUI å¯è§†åŒ–å™¨ (`gui_visualizer.py`)

#### åŠŸèƒ½ç‰¹æ€§

1. **å®æ—¶å¤„ç†**ï¼š
   - ä½¿ç”¨ MediaPipe æå–çœ¼éƒ¨ ROI
   - SwinUNet æ¨¡å‹æ¨ç†
   - å®æ—¶æ˜¾ç¤º Pitch/Yaw è§’åº¦

2. **çœ¨çœ¼å¤„ç†**ï¼š
   - åŸºäº EARï¼ˆEye Aspect Ratioï¼‰æ£€æµ‹çœ¨çœ¼
   - **ä¸¤é˜¶æ®µå¤„ç†**ï¼šå…ˆæ‰«æå…¨éƒ¨çœ¨çœ¼äº‹ä»¶ï¼Œå†å¯¹ç§°æ‰©å±•çª—å£
   - æ—¶é—´çª—å£æ‰©å±•ï¼šçœ¨çœ¼æ—¶åˆ» Â±300ms æ ‡è®°ä¸ºä¸å¯é 
   - è¦†ç›–å®Œå…¨é—­çœ¼å’Œå¾®é—­ï¼ˆåŠçœ¨çœ¼ï¼‰çŠ¶æ€
   - çº¿æ€§æ’å€¼å¡«å……ï¼Œè™šçº¿æ˜¾ç¤ºæ’å€¼æ®µ

3. **ä¿¡å·æ»¤æ³¢**ï¼š
   - ä¸­å€¼æ»¤æ³¢ï¼ˆkernel_size=5ï¼‰ï¼šå»é™¤å°–å³°å™ªå£°
   - ä½é€šæ»¤æ³¢ï¼ˆButterworth, cutoff=5Hzï¼‰ï¼šå¹³æ»‘æ›²çº¿

4. **äº¤äº’å¼å›æ”¾**ï¼š
   - æ‹–åŠ¨å›¾è¡¨æ—¶é—´è½´
   - æ˜¾ç¤ºå¯¹åº”æ—¶åˆ»çš„è§†é¢‘å¸§å’Œçœ¼éƒ¨å›¾åƒ
   - å®æ—¶æ˜¾ç¤º 3D æ³¨è§†å‘é‡ç®­å¤´å¯è§†åŒ–

5. **æ•°æ®å¯¼å‡º**ï¼š
   - ä¸€é”®ä¿å­˜ä¸º Plist æ ¼å¼
   - å…¼å®¹ pVestibular åˆ†æå¹³å°
   - åŒ…å«å®Œæ•´çš„æ—¶é—´æˆ³å’Œå…ƒæ•°æ®

#### ä½¿ç”¨ç¤ºä¾‹

```python
# å¯åŠ¨ GUI
python gui_visualizer.py

# 1. é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼ˆMKV/MP4/AVIï¼‰
# 2. åŠ è½½æ¨¡å‹æ£€æŸ¥ç‚¹ï¼ˆè‡ªåŠ¨åŠ è½½ checkpoint_best.pthï¼‰
# 3. é€‰æ‹©å¤„ç†é€‰é¡¹ï¼š
#    - ğŸ¬ Enable Real-time Animation: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿‡ç¨‹ï¼ˆè¾ƒæ…¢ï¼‰
#    - ğŸ¯ Show 3D Gaze Vector Window: æ˜¾ç¤º 3D æ³¨è§†å‘é‡å¯è§†åŒ–
# 4. ç‚¹å‡» "Start Processing"
# 5. ç­‰å¾…å¤„ç†å®Œæˆï¼ˆå¿«é€Ÿæ¨¡å¼æ˜¾ç¤ºè¿›åº¦æ¡ï¼‰
# 6. æ‹–åŠ¨å›¾è¡¨æŸ¥çœ‹ä»»æ„å¸§
# 7. ç‚¹å‡» "ğŸ’¾ Save as Plist" ä¿å­˜æ•°æ®
```

#### å¤„ç†æ¨¡å¼

**å¿«é€Ÿæ¨¡å¼ï¼ˆæ¨èï¼‰**ï¼š
- ä¸å‹¾é€‰ "Real-time Animation"
- åªæ˜¾ç¤ºè¿›åº¦çª—å£
- å¤„ç†é€Ÿåº¦å¿« 2-3 å€
- å®Œæˆåä¸€æ¬¡æ€§å¼¹å‡ºæ‰€æœ‰çª—å£

**åŠ¨ç”»æ¨¡å¼**ï¼š
- å‹¾é€‰ "Real-time Animation"
- å®æ—¶æ˜¾ç¤ºçœ¼éƒ¨ ROI å’Œè§’åº¦æ›²çº¿
- å¯ä»¥è§‚å¯Ÿå¤„ç†è¿‡ç¨‹
- å¤„ç†é€Ÿåº¦è¾ƒæ…¢

#### å¯è§†åŒ–çª—å£è¯´æ˜

å¤„ç†å®Œæˆåä¼šæ‰“å¼€ä»¥ä¸‹çª—å£ï¼š

1. **Gaze Angles Plot**ï¼ˆå¿…é€‰ï¼‰ï¼š
   - Pitch/Yaw è§’åº¦æ—¶é—´åºåˆ—å›¾
   - å¯æ‹–åŠ¨æ—¶é—´è½´æ¸¸æ ‡
   - å®çº¿ï¼šæ­£å¸¸æ•°æ®ï¼Œè™šçº¿ï¼šçœ¨çœ¼æ’å€¼
   - ğŸ’¾ Save as Plist æŒ‰é’®

2. **Eye Input**ï¼ˆå¿…é€‰ï¼‰ï¼š
   - å½“å‰å¸§çš„çœ¼éƒ¨ ROIï¼ˆ36Ã—60ï¼‰
   - è·Ÿéšæ—¶é—´è½´å®æ—¶æ›´æ–°

3. **Video Frame**ï¼ˆå¿…é€‰ï¼‰ï¼š
   - å®Œæ•´è§†é¢‘å¸§
   - è·Ÿéšæ—¶é—´è½´å®æ—¶æ›´æ–°

4. **3D Gaze Vector**ï¼ˆå¯é€‰ï¼‰ï¼š
   - å‹¾é€‰ "Show 3D Gaze Vector Window" æ‰æ˜¾ç¤º
   - 3D ç©ºé—´ä¸­çš„äººçœ¼-æ‘„åƒå¤´å…³ç³»
   - é’è‰²ç®­å¤´ï¼šæ³¨è§†å‘é‡
   - è·Ÿéšæ—¶é—´è½´å®æ—¶æ›´æ–°

#### å›¾è¡¨è¯´æ˜

- **å®çº¿**ï¼šçœŸå®é‡‡é›†çš„æ•°æ®ï¼ˆç»è¿‡æ»¤æ³¢ï¼‰
- **è™šçº¿**ï¼šçœ¨çœ¼æ—¶çš„æ’å€¼æ•°æ®
- **åŠé€æ˜**ï¼šåŸå§‹æœªå¤„ç†æ•°æ®
- **çº¢è‰²**ï¼šPitchï¼ˆä¿¯ä»°è§’ï¼Œå‚ç›´æ–¹å‘ï¼‰
- **è“è‰²**ï¼šYawï¼ˆåèˆªè§’ï¼Œæ°´å¹³æ–¹å‘ï¼‰

#### æ•°æ®ä¿å­˜

ç‚¹å‡» "ğŸ’¾ Save as Plist" æŒ‰é’®ä¼šä¿å­˜ **ä¸¤ä¸ªæ–‡ä»¶**ï¼š

1. **`*_raw.plist`** - åŸå§‹æ•°æ®
   - ä»…åŒ…å«çœ¨çœ¼æ’å€¼
   - æ— æ»¤æ³¢å¤„ç†
   - é€‚åˆè‡ªå®šä¹‰åå¤„ç†

2. **`*_filtered.plist`** - æ»¤æ³¢æ•°æ®
   - ä¸­å€¼æ»¤æ³¢å»é™¤æ¯›åˆº
   - ä½é€šæ»¤æ³¢å¹³æ»‘æ›²çº¿
   - é€‚åˆç›´æ¥åˆ†æå’Œå¯è§†åŒ–

**æ•°æ®æ ¼å¼**ï¼ˆå…¼å®¹ pVestibularï¼‰ï¼š
```python
{
    'TimeList': [...],              # æ—¶é—´æˆ³
    'LeftEyeXDegList': [...],       # Yaw è§’åº¦ï¼ˆæ°´å¹³ï¼‰
    'LeftEyeYDegList': [...],       # Pitch è§’åº¦ï¼ˆå‚ç›´ï¼‰
    'GazePitchDegList': [...],      # Pitch è§’åº¦
    'GazeYawDegList': [...],        # Yaw è§’åº¦
    'GazeXList': [...],             # 3D å‘é‡ X
    'GazeYList': [...],             # 3D å‘é‡ Y
    'GazeZList': [...],             # 3D å‘é‡ Z
    'VideoFile': 'xxx.mkv',         # è§†é¢‘æ–‡ä»¶å
    'FPS': 30.0,                    # å¸§ç‡
    'TotalFrames': 1000,            # æ€»å¸§æ•°
    'FilteredData': True/False,     # æ˜¯å¦æ»¤æ³¢
    ...
}
```

#### æ€§èƒ½ä¼˜åŒ–

**å†…å­˜ç®¡ç†**ï¼š
- ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å­˜å‚¨å†å²æ•°æ®
- æ¯ 1000 å¸§è‡ªåŠ¨å†™å…¥ç£ç›˜
- å¤„ç†å®Œæˆåè‡ªåŠ¨æ¸…ç†
- é€‚åˆå¤„ç†é•¿è§†é¢‘ï¼ˆ> 10 åˆ†é’Ÿï¼‰

**æ»¤æ³¢å‚æ•°**ï¼ˆå¯åœ¨ä»£ç ä¸­è°ƒæ•´ï¼‰ï¼š
```python
SignalProcessor(
    fps=30.0,           # è§†é¢‘å¸§ç‡
    low_pass_cutoff=8.0 # ä½é€šæ»¤æ³¢æˆªæ­¢é¢‘ç‡ï¼ˆHzï¼‰
)
```

---

## æ€§èƒ½ä¸ç³»ç»Ÿéœ€æ±‚

### âš¡ æ€§èƒ½æ¦‚è§ˆ

**CPU æ¨¡å¼** (å½“å‰æµ‹è¯•ç»“æœ):
- å¤„ç†é€Ÿåº¦: **56.6 FPS** (å®æ—¶çš„ 1.89x)
- 1 åˆ†é’Ÿè§†é¢‘: **32 ç§’**
- 10 åˆ†é’Ÿè§†é¢‘: **5.3 åˆ†é’Ÿ**

**GPU æ¨¡å¼** (GTX 1060+):
- å¤„ç†é€Ÿåº¦: **200-300 FPS** (4-5x åŠ é€Ÿ)
- 1 åˆ†é’Ÿè§†é¢‘: **6-12 ç§’**
- 10 åˆ†é’Ÿè§†é¢‘: **1-2 åˆ†é’Ÿ**

### ğŸ’» æ¨èé…ç½®

#### CPU æ¨¡å¼ (åŸºç¡€)
```
å¤„ç†å™¨: Intel i7-10ä»£ æˆ– AMD Ryzen 7 5000
å†…å­˜:   8 GB RAM
é€‚ç”¨:   ä¸­ç­‰è§†é¢‘ (< 10 åˆ†é’Ÿ)
```

#### GPU æ¨¡å¼ (æ¨è) â­
```
å¤„ç†å™¨: Intel i5-8ä»£ æˆ–æ›´é«˜
æ˜¾å¡:   NVIDIA GTX 1060 (6GB) æˆ–æ›´é«˜
å†…å­˜:   8 GB RAM
æ˜¾å­˜:   4 GB VRAM
é€‚ç”¨:   ä»»æ„é•¿åº¦è§†é¢‘
```

### ğŸ“Š è¯¦ç»†æ€§èƒ½æŠ¥å‘Š

æŸ¥çœ‹ [PERFORMANCE.md](PERFORMANCE.md) è·å–å®Œæ•´çš„æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœï¼ŒåŒ…æ‹¬ï¼š
- è¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡
- ä¸åŒé…ç½®çš„å¤„ç†é€Ÿåº¦å¯¹æ¯”
- å†…å­˜ä½¿ç”¨åˆ†æ
- ç³»ç»Ÿéœ€æ±‚å»ºè®®
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§

---

## Web éƒ¨ç½²

Web ç‰ˆæœ¬ä½äº `js/` æ–‡ä»¶å¤¹ï¼Œæ”¯æŒæµè§ˆå™¨ç«¯å®æ—¶æ¨ç†ã€‚

### å¿«é€Ÿå¯åŠ¨

```bash
cd js

# 1. ä¸‹è½½ä¾èµ–ï¼ˆONNX Runtime, MediaPipe, Chart.jsï¼‰
python download_dependencies.py

# 2. å¯¼å‡º ONNX æ¨¡å‹ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼‰
cd ..
python export_to_onnx.py --checkpoint checkpoints/checkpoint_best.pth --output models/swinunet_web.onnx

# 3. å¯åŠ¨æœåŠ¡å™¨
cd js
python server.py

# 4. æ‰“å¼€æµè§ˆå™¨è®¿é—®
# http://localhost:8000/demo.html
```

### Web ç‰ˆåŠŸèƒ½

- âœ… è§†é¢‘æ–‡ä»¶ä¸Šä¼ ï¼ˆæ‹–æ‹½æˆ–é€‰æ‹©ï¼‰
- âœ… MediaPipe äººè„¸æ£€æµ‹å’Œçœ¼éƒ¨æå–
- âœ… ONNX Runtime æ¨¡å‹æ¨ç†
- âœ… å®æ—¶ Pitch/Yaw è§’åº¦å›¾è¡¨
- âœ… FPS æ˜¾ç¤º
- âœ… çœ¼éƒ¨ ROI å¯è§†åŒ–

### æ–‡ä»¶ç»“æ„

```
js/
â”œâ”€â”€ demo.html                    # ä¸»æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ server.py                    # è‡ªå®šä¹‰ HTTP æœåŠ¡å™¨
â”œâ”€â”€ download_dependencies.py     # ä¾èµ–ä¸‹è½½è„šæœ¬
â”œâ”€â”€ swinunet-gaze-api.js        # JavaScript API
â”œâ”€â”€ API_REFERENCE.md             # JavaScript API æ–‡æ¡£
â””â”€â”€ lib/                         # æœ¬åœ°ä¾èµ–
    â”œâ”€â”€ ort.min.js              # ONNX Runtime
    â”œâ”€â”€ ort-wasm*.wasm          # WASM æ–‡ä»¶
    â”œâ”€â”€ face_mesh.js            # MediaPipe
    â”œâ”€â”€ face_mesh*.wasm         # MediaPipe WASM
    â””â”€â”€ chart.min.js            # Chart.js
```

### ä½¿ç”¨è¯´æ˜

**å¯åŠ¨æœåŠ¡å™¨**ï¼š
```bash
cd js
python server.py
```

**è®¿é—®æ¼”ç¤º**ï¼š
æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8000/demo.html

**åŠŸèƒ½**ï¼š
- ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼ˆæ‹–æ‹½æˆ–é€‰æ‹©ï¼‰
- è‡ªåŠ¨æ£€æµ‹äººè„¸å’Œæå–çœ¼éƒ¨ ROI
- å®æ—¶æ˜¾ç¤º Pitch/Yaw è§’åº¦æ›²çº¿
- FPS æ€§èƒ½ç›‘æ§

**æ³¨æ„äº‹é¡¹**ï¼š
- é¦–æ¬¡ä½¿ç”¨éœ€è¦è¿è¡Œ `python download_dependencies.py` ä¸‹è½½ä¾èµ–
- éœ€è¦å…ˆå¯¼å‡º ONNX æ¨¡å‹åˆ° `../models/swinunet_web.onnx`
- ä½¿ç”¨ `server.py` è€Œé `python -m http.server`ï¼ˆæ­£ç¡®çš„ MIME ç±»å‹ï¼‰

---

## æŠ€æœ¯ç»†èŠ‚

### MPIIGaze æ•°æ®é›†

- **è§„æ¨¡**ï¼š15 äººï¼Œ~45,000 å¼ çœ¼éƒ¨å›¾åƒ
- **å›¾åƒå°ºå¯¸**ï¼š36Ã—60Ã—3ï¼ˆå½’ä¸€åŒ–åï¼‰
- **æ ‡æ³¨**ï¼š3D æ³¨è§†å‘é‡ (x, y, z)ï¼ŒèŒƒå›´ [-1, 1]
- **é‡‡é›†ç¯å¢ƒ**ï¼šæ—¥å¸¸åŠå…¬åœºæ™¯ï¼Œå¤šç§å…‰ç…§å’Œå¤´éƒ¨å§¿æ€

### å‡ ä½•å½’ä¸€åŒ–

MPIIGaze æ•°æ®å·²ç»è¿‡å‡ ä½•å½’ä¸€åŒ–ï¼š
1. æ£€æµ‹äººè„¸å…³é”®ç‚¹
2. è®¡ç®—å¤´éƒ¨å§¿æ€ï¼ˆæ—‹è½¬çŸ©é˜µï¼‰
3. å°†çœ¼éƒ¨å›¾åƒæ—‹è½¬åˆ°æ ‡å‡†è§†è§’
4. è£å‰ªå¹¶ç¼©æ”¾åˆ° 36Ã—60

### åæ ‡ç³»ç»Ÿ

éµå¾ª MPIIGaze çº¦å®šï¼š
```python
# 3D æ³¨è§†å‘é‡è½¬è§’åº¦
Pitch = arcsin(-y)        # å‚ç›´è§’åº¦ï¼ŒèŒƒå›´ [-90Â°, 90Â°]
Yaw = arctan2(-x, -z)     # æ°´å¹³è§’åº¦ï¼ŒèŒƒå›´ [-180Â°, 180Â°]
```

å…¸å‹èŒƒå›´ï¼ˆåŸºäºæ•°æ®é›†ç»Ÿè®¡ï¼‰ï¼š
- Pitch: [-25Â°, 45Â°]
- Yaw: [-45Â°, 45Â°]

### çœ¨çœ¼æ£€æµ‹

ä½¿ç”¨ Eye Aspect Ratio (EAR)ï¼š
```python
EAR = å‚ç›´è·ç¦» / æ°´å¹³è·ç¦»
é˜ˆå€¼: EAR < 0.20 è®¤ä¸ºæ˜¯çœ¨çœ¼
```

æ—¶é—´çª—å£æ‰©å±•ï¼ˆä¸¤é˜¶æ®µå¤„ç†ï¼‰ï¼š
- **é˜¶æ®µ 1**ï¼šå¿«é€Ÿæ‰«æè§†é¢‘ï¼Œè®°å½•æ‰€æœ‰çœ¨çœ¼æ—¶åˆ»
- **é˜¶æ®µ 2**ï¼šé‡æ–°å¤„ç†ï¼Œå¯¹æ¯ä¸ªçœ¨çœ¼æ—¶åˆ» t åº”ç”¨å¯¹ç§°çª—å£
- æ ‡è®° [t-300ms, t+300ms] ä¸ºä¸å¯é æ•°æ®
- è¦†ç›–å®Œå…¨é—­çœ¼å’Œå¾®é—­ï¼ˆåŠçœ¨çœ¼ï¼‰çš„è¿‡æ¸¡æœŸ
- ä½¿ç”¨çº¿æ€§æ’å€¼å¡«å……

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µï¼Ÿ**
- çœ¨çœ¼å‰çš„å¾®é—­çŠ¶æ€ä¹Ÿä¼šå½±å“æ•°æ®è´¨é‡
- å•æ¬¡æ‰«ææ— æ³•å›æº¯ä¹‹å‰çš„å¸§
- ä¸¤é˜¶æ®µå¤„ç†ç¡®ä¿å¯¹ç§°çª—å£æ­£ç¡®åº”ç”¨

---

## å¸¸è§é—®é¢˜

### Q: è¿è¡Œ GUI æ—¶å‡ºç° protobuf å¯¼å…¥é”™è¯¯ï¼Ÿ
A: è¿™æ˜¯ä¾èµ–ç‰ˆæœ¬å†²çªã€‚GUI å·¥å…·ä¸éœ€è¦ TensorFlowï¼Œå¯ä»¥å¸è½½ï¼š
```bash
# å¸è½½ TensorFlow
pip uninstall tensorflow tensorflow-intel keras tensorboard tensorflow-estimator -y

# å®‰è£…æ­£ç¡®çš„ protobuf ç‰ˆæœ¬
pip install "protobuf>=4.25.3,<5"
pip install "ml_dtypes>=0.5.0"
```

### Q: è®­ç»ƒæ—¶æ˜¾å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
A: å‡å° `batch_size`ï¼Œä¾‹å¦‚ï¼š
```bash
python train.py --batch_size 64
```

### Q: å¦‚ä½•åˆ‡æ¢å·¦çœ¼/å³çœ¼ï¼Ÿ
A: ä¿®æ”¹ `gui_visualizer.py` ç¬¬ 467 è¡Œï¼š
```python
self.normalizer = MediaPipeEyeNormalizer(eye='right', ...)  # 'left' æˆ– 'right'
```

### Q: Web ç‰ˆåŠ è½½å¾ˆæ…¢ï¼Ÿ
A: ç¡®ä¿å·²è¿è¡Œ `download_dependencies.py` ä¸‹è½½æœ¬åœ°ä¾èµ–ï¼Œé¿å…ä» CDN åŠ è½½ã€‚

### Q: å¦‚ä½•è°ƒæ•´çœ¨çœ¼çª—å£å¤§å°ï¼Ÿ
A: ä¿®æ”¹ `gui_visualizer.py` ç¬¬ 517 è¡Œï¼š
```python
self.normalizer = MediaPipeEyeNormalizer(
    eye='left', 
    blink_window_extend_sec=0.3  # é»˜è®¤ 0.3 ç§’ï¼Œè¦†ç›–å®Œå…¨é—­çœ¼å’Œå¾®é—­çŠ¶æ€
)
```
**å»ºè®®å€¼**ï¼š
- **120 FPS è§†é¢‘**ï¼š0.3 ç§’ï¼ˆè¦†ç›– 36 å¸§ï¼ŒåŒ…å«å¾®é—­è¿‡æ¸¡æœŸï¼‰
- 60 FPS è§†é¢‘ï¼š0.3-0.4 ç§’ï¼ˆè¦†ç›– 18-24 å¸§ï¼‰
- 30 FPS è§†é¢‘ï¼š0.4-0.5 ç§’ï¼ˆè¦†ç›– 12-15 å¸§ï¼‰

**è¯´æ˜**ï¼š
- çª—å£ä¸ä»…è¿‡æ»¤å®Œå…¨é—­çœ¼ï¼Œä¹Ÿè¿‡æ»¤çœ¼ç›å¾®é—­ï¼ˆåŠçœ¨çœ¼ï¼‰æ—¶çš„ä¸ç¨³å®šæ•°æ®
- é‡‡ç”¨ä¸¤é˜¶æ®µå¤„ç†ï¼Œç¡®ä¿å¯¹ç§°çª—å£æ­£ç¡®åº”ç”¨äºçœ¨çœ¼å‰å

### Q: å¦‚ä½•å¯¼å‡º ONNX æ¨¡å‹ï¼Ÿ
A: ä½¿ç”¨ `export_to_onnx.py`ï¼š
```bash
python export_to_onnx.py \
    --checkpoint checkpoints/checkpoint_best.pth \
    --output models/swinunet_web.onnx
```

### Q: æ¨¡å‹æ€§èƒ½å¦‚ä½•ï¼Ÿ
A: åœ¨ MPIIGaze æ•°æ®é›†ä¸Šï¼š
- è·¨è¢«è¯•è¯„ä¼°ï¼š~5.7Â° å¹³å‡è§’åº¦è¯¯å·®
- ä¸ªäººåŒ–è¯„ä¼°ï¼š~4.5Â° å¹³å‡è§’åº¦è¯¯å·®
- æ¨ç†é€Ÿåº¦ï¼š~30 FPSï¼ˆGPUï¼‰/ ~10 FPSï¼ˆCPUï¼‰

---

## é¡¹ç›®ç»“æ„

```
SwinUNet-VOG/
â”œâ”€â”€ README.md                    # ğŸ“˜ é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ requirements.txt             # ğŸ“¦ Python ä¾èµ–
â”œâ”€â”€ config.json                  # âš™ï¸ é…ç½®æ–‡ä»¶
â”œâ”€â”€ .gitignore                   # ğŸš« Git å¿½ç•¥è§„åˆ™
â”‚
â”œâ”€â”€ train.py                     # ğŸ“ æ¨¡å‹è®­ç»ƒ
â”œâ”€â”€ test.py                      # ğŸ“Š æ¨¡å‹è¯„ä¼°
â”œâ”€â”€ model.py                     # ğŸ§  SwinUNet æ¨¡å‹å®šä¹‰
â”œâ”€â”€ data.py                      # ğŸ’¾ æ•°æ®åŠ è½½å™¨
â”œâ”€â”€ preprocessing.py             # ğŸ”§ é¢„å¤„ç†å·¥å…·
â”œâ”€â”€ geometric_normalization.py   # ğŸ“ å‡ ä½•å½’ä¸€åŒ–
â”œâ”€â”€ gui_visualizer.py            # ğŸ–¥ï¸ GUI å¯è§†åŒ–å·¥å…·
â”œâ”€â”€ visualize_results.py         # ğŸ“ˆ è¯„ä¼°å¯è§†åŒ–
â”œâ”€â”€ export_to_onnx.py            # ğŸ“¤ ONNX å¯¼å‡º
â”‚
â”œâ”€â”€ checkpoints/                 # ğŸ’¾ æ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â”œâ”€â”€ checkpoint_best.pth
â”‚   â””â”€â”€ checkpoint_latest.pth
â”‚
â”œâ”€â”€ models/                      # ğŸ¤– å¯¼å‡ºçš„æ¨¡å‹
â”‚   â”œâ”€â”€ swinunet.onnx
â”‚   â””â”€â”€ swinunet_web.onnx
â”‚
â”œâ”€â”€ MPIIGaze/                    # ğŸ“‚ æ•°æ®é›†
â”‚
â””â”€â”€ js/                          # ğŸŒ Web éƒ¨ç½²
    â”œâ”€â”€ demo.html                # æ¼”ç¤ºé¡µé¢
    â”œâ”€â”€ server.py                # HTTP æœåŠ¡å™¨
    â”œâ”€â”€ download_dependencies.py # ä¾èµ–ä¸‹è½½
    â”œâ”€â”€ swinunet-gaze-api.js     # JavaScript API
    â”œâ”€â”€ API_REFERENCE.md         # API æ–‡æ¡£
    â””â”€â”€ lib/                     # JavaScript ä¾èµ–åº“
```

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) è®¸å¯è¯ã€‚

## å¼•ç”¨

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@misc{swinunet-vog,
  title={SwinUNet-VOG: Swin Transformer-based Gaze Estimation},
  author={Your Name},
  year={2024},
  howpublished={\url{https://github.com/your-repo/SwinUNet-VOG}}
}
```

## è‡´è°¢

- [MPIIGaze Dataset](https://www.mpi-inf.mpg.de/departments/computer-vision-and-machine-learning/research/gaze-based-human-computer-interaction/appearance-based-gaze-estimation-in-the-wild/)
- [Swin Transformer](https://github.com/microsoft/Swin-Transformer)
- [MediaPipe](https://google.github.io/mediapipe/)
- [ONNX Runtime](https://onnxruntime.ai/)

---

## é¡¹ç›®ç²¾ç®€è¯´æ˜

æœ¬é¡¹ç›®å·²è¿›è¡Œå…¨é¢æ•´ç†ï¼Œåˆ é™¤äº†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ã€ä¸´æ—¶è„šæœ¬å’Œå†—ä½™æ–‡æ¡£ï¼š

### ç²¾ç®€æ•ˆæœ
- **æ–‡æ¡£**: ä» 12 ä¸ª MD æ–‡ä»¶ç²¾ç®€åˆ° 2 ä¸ªï¼ˆä¸» README + JS API æ–‡æ¡£ï¼‰
- **HTML**: ä» 6 ä¸ªç²¾ç®€åˆ° 1 ä¸ªï¼ˆdemo.htmlï¼‰
- **è„šæœ¬**: åˆ é™¤äº†æ‰€æœ‰å¯åŠ¨/éƒ¨ç½²è„šæœ¬ï¼Œç›´æ¥ä½¿ç”¨ `python server.py`
- **å¯¼å‡ºå·¥å…·**: ä» 4 ä¸ªç²¾ç®€åˆ° 1 ä¸ªï¼ˆexport_to_onnx.pyï¼‰

### æ ¸å¿ƒæ–‡ä»¶
- **æ ¹ç›®å½•**: 13 ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼ˆè®­ç»ƒã€è¯„ä¼°ã€å¯è§†åŒ–ï¼‰
- **js æ–‡ä»¶å¤¹**: 5 ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼ˆWeb éƒ¨ç½²ï¼‰
- **æ— å†—ä½™**: æ— æµ‹è¯•æ–‡ä»¶ã€æ— ä¸´æ—¶è„šæœ¬ã€æ— é‡å¤æ–‡æ¡£

é¡¹ç›®ç°åœ¨ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œä½¿ç”¨ã€‚

