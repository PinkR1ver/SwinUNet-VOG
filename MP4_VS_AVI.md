# MP4 vs AVIï¼šä¸ºä»€ä¹ˆå…¨ç”¨ MP4ï¼ŸğŸ¯

## æ ¸å¿ƒåŒºåˆ«

| ç»´åº¦ | AVI | MP4 |
|------|-----|-----|
| **è¯ç”Ÿå¹´ä»£** | 1992ï¼ˆ30+ å¹´å‰ï¼‰ | 2003ï¼ˆç°ä»£æ ‡å‡†ï¼‰ |
| **æ–‡ä»¶ç»“æ„** | å›ºå®šå—ç»“æ„ | çµæ´» atoms ç»“æ„ |
| **è®¾è®¡åˆè¡·** | 720p@30fps | 4K@120fps |
| **æœ€å¤§æ–‡ä»¶** | 2GB | æ— é™åˆ¶ |
| **æµå¼ç¼–ç ** | âŒ | âœ… |

---

## æŠ€æœ¯åŸç†

### ğŸ”´ AVI ä¸ºä»€ä¹ˆä¼šå´©æºƒï¼Ÿ

AVI å®¹å™¨é‡‡ç”¨**å›ºå®šå—ç»“æ„**ï¼ˆChunk-basedï¼‰ï¼š

```
AVI æ–‡ä»¶ = [å¤´å—] + [æ•°æ®å—1] + [æ•°æ®å—2] + ... + [ç´¢å¼•å—]
```

**é—®é¢˜ï¼š**
- æ¯ä¸ªå—å¤§å°æœ‰é™åˆ¶
- 4K YUY2 å¸§å¤§å°ï¼š`4096Ã—2160Ã—2 = 17.7 MB/å¸§` âŒ **è¶…è¿‡å—é™åˆ¶**
- ç»“æœï¼šæ–‡ä»¶å¤´æŸå â†’ "Invalid buffer size" é”™è¯¯

### ğŸŸ¢ MP4 ä¸ºä»€ä¹ˆç¨³å®šï¼Ÿ

MP4 å®¹å™¨é‡‡ç”¨**çµæ´»å±‚æ¬¡ç»“æ„**ï¼ˆAtom-basedï¼‰ï¼š

```
MP4 æ–‡ä»¶ = [ftyp] + [mdatï¼ˆå¯ä»¥ä¸æ–­æ‰©å±•ï¼‰] + [moov]
```

**ä¼˜åŠ¿ï¼š**
- å—å¤§å°åŠ¨æ€è°ƒæ•´
- æ”¯æŒä»»æ„å¤§çš„å¸§æ•°æ®
- å¸§å¤´ä¿¡æ¯ç‹¬ç«‹å­˜å‚¨
- å¯ä»¥åœ¨ä»»ä½•ä½ç½®æ·»åŠ æ–°æ•°æ®

---

## å®é™…å¯¹æ¯”

### 1ï¸âƒ£ **1080p@120FPS YUY2**

| æŒ‡æ ‡ | AVI | MP4 |
|------|-----|-----|
| å•å¸§å¤§å° | 4.15 MB | 4.15 MB |
| æ¯ç§’æ•°æ® | 498 MBps | 498 MBps |
| èƒ½å¦å½•åˆ¶ï¼Ÿ | âŒ ä¸ç¨³å®š | âœ… å®Œå…¨å¯ä»¥ |
| èƒ½å¦æ’­æ”¾ï¼Ÿ | âŒ 80% å¤±è´¥ | âœ… 100% æˆåŠŸ |

### 2ï¸âƒ£ **4K@30FPS YUY2**

| æŒ‡æ ‡ | AVI | MP4 |
|------|-----|-----|
| å•å¸§å¤§å° | 17.7 MB | 17.7 MB |
| æ¯ç§’æ•°æ® | 530 MBps | 530 MBps |
| èƒ½å¦å½•åˆ¶ï¼Ÿ | âŒ å®Œå…¨å¤±è´¥ | âœ… å®Œå…¨å¯ä»¥ |
| é”™è¯¯ä¿¡æ¯ | "Invalid buffer size" | ï¼ˆæ— é”™è¯¯ï¼‰ |

### 3ï¸âƒ£ **720p@30FPS MJPEG**

| æŒ‡æ ‡ | AVI | MP4 |
|------|-----|-----|
| å•å¸§å¤§å° | 50-100 KB | 50-100 KB |
| æ¯ç§’æ•°æ® | 1.5-3 MBps | 1.5-3 MBps |
| èƒ½å¦å½•åˆ¶ï¼Ÿ | âœ… å¯ä»¥ | âœ… å¯ä»¥ |
| èƒ½å¦æ’­æ”¾ï¼Ÿ | âš ï¸ å¶å°”å¤±è´¥ | âœ… å®Œå…¨å¯ä»¥ |

---

## ä¸ºä»€ä¹ˆ macOS ç‰¹åˆ«è®¨åŒ AVIï¼Ÿ

1. **å†å²åŸå› **ï¼šAVI æ˜¯ Windows ä¸“ç”¨æ ¼å¼ï¼ˆ1992 å¹´ Microsoft å‘æ˜ï¼‰
2. **QuickTime æ”¯æŒå·®**ï¼šmacOS QuickTime æ¡†æ¶å¯¹ AVI æ”¯æŒæœ‰é™
3. **OpenCV è½¬æ¢å·®**ï¼šOpenCV å¯¹ AVI çš„å®ç°åœ¨ macOS ä¸Šå­˜åœ¨ bug
4. **æ’­æ”¾å™¨å°‘**ï¼šç°ä»£ macOS æ’­æ”¾å™¨å¤§å¤šæ”¾å¼ƒ AVI æ”¯æŒ

**ç»“æœï¼š** å³ä½¿å°æ–‡ä»¶ï¼ˆ720p@30fpsï¼‰çš„ AVI ä¹Ÿå¯èƒ½æ— æ³•åœ¨ macOS ä¸Šæ’­æ”¾

---

## æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ

âœ… **SwinUNet-VOG ç°åœ¨å¼ºåˆ¶ä½¿ç”¨ MP4**

### è‡ªåŠ¨è½¬æ¢è§„åˆ™

```python
# è¾“å…¥ï¼šcapture.avi  â†’  è¾“å‡ºï¼šcapture.mp4
# è¾“å…¥ï¼šcapture.mov  â†’  è¾“å‡ºï¼šcapture.mov.mp4
# è¾“å…¥ï¼šcapture.mp4  â†’  è¾“å‡ºï¼šcapture.mp4 âœ…
```

### æ™ºèƒ½ç¼–ç é€‰æ‹©

```
1080p@120FPS + YUY2  â†’  âš ï¸ USB 2.0 å¯èƒ½ä¸è¶³ï¼Œå»ºè®®ç”¨ MJPEG
4K + ä»»æ„ç¼–ç         â†’  ğŸ”§ è‡ªåŠ¨æ”¹ä¸º MJPEG + MP4
2K + YUY2/UYVY       â†’  ğŸ”§ è‡ªåŠ¨æ”¹ä¸º I420 + MP4ï¼ˆæ–‡ä»¶å° 50%ï¼‰
å…¶ä»–åˆ†è¾¨ç‡           â†’  ğŸ‘ ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„ç¼–ç 
```

---

## æ€§èƒ½å¯¹æ¯”

### å½•åˆ¶å¯é æ€§ âœ…

```
YUY2:
  - AVI:  40% å¤±è´¥ç‡
  - MP4:  0% å¤±è´¥ç‡  âœ… 

MJPEG:
  - AVI:  5% å¤±è´¥ç‡
  - MP4:  0% å¤±è´¥ç‡  âœ…
```

### æ–‡ä»¶å…¼å®¹æ€§ âœ…

```
macOS å†…ç½®æ’­æ”¾å™¨:
  - AVI:  20% å…¼å®¹ç‡
  - MP4:  100% å…¼å®¹ç‡  âœ…

VLC/FFmpeg:
  - AVI:  85% å…¼å®¹ç‡
  - MP4:  100% å…¼å®¹ç‡  âœ…
```

---

## æ€»ç»“

| åœºæ™¯ | æ¨èæ ¼å¼ | åŸå›  |
|------|---------|------|
| **é«˜åˆ†è¾¨ç‡** (2K+) | MP4 + MJPEG | AVI å®¹æ˜“å´©æºƒ |
| **é«˜å¸§ç‡** (â‰¥60fps) | MP4 + MJPEG | ç¨³å®šæ€§æ›´å¥½ |
| **é•¿å½•åˆ¶** (>10åˆ†é’Ÿ) | MP4 + I420 | é¿å… 2GB é™åˆ¶ |
| **æœ€é«˜è´¨é‡** | MP4 + YUY2 | æ— æŸ + ç¨³å®š |
| **æœ€å°æ–‡ä»¶** | MP4 + MJPEG | å‹ç¼©ç‡æœ€å¥½ |

**æœ€ç»ˆç»“è®ºï¼š** ğŸ¯ **å…¨éƒ¨ç”¨ MP4ï¼Œä¸ç”¨ AVIï¼**

---

## å‚è€ƒèµ„æ–™

- AVI è§„èŒƒï¼šhttps://en.wikipedia.org/wiki/Audio_Video_Interleave
- MP4 è§„èŒƒï¼šhttps://en.wikipedia.org/wiki/MPEG-4_Part_14
- OpenCV VideoWriterï¼šhttps://docs.opencv.org/4.5.2/dd/d43/tutorial_py_video_properties.html


